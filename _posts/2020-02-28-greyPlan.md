---
layout:     post
title:      一个简单的灰度方案设计
subtitle:   简简单单写一个简简单单的灰度方案，然后发现自己真的不会写文档😭
date:       2020-02-28
author:     zhi
header-img: img/2020022802_bg.gif
catalog: true
tags:
    - LIFE
    - 瞎嘚嘚
---


## 概述

灰度方案是一种让开发在黑白之间平滑过度的一种发布方案，让部分用户使用稳定的旧方案，让另一部分用户使用新方案，如果对于新方案没有问题，那么就把灰度开关开到最大使用新逻辑。灰度方案可以整体系统的稳定性，并且可以在灰度期间发现问题、解决问题、调整问题，降低出现问题的损失，保证上线进度。


## 实现思路
大体实现逻辑
![699e59b86191ecb2212b062776a52550.png](evernotecid://B6D2603C-2349-47FA-A4DE-C3AEAB1D501D/appyinxiangcom/12798685/ENResource/p336)

本方案灰度逻辑实现在代码层面

## 具体实现

### DB 设计

```SQL
-- auto-generated definition
create table gray_feature
(
    id int auto_increment comment '自增主键' primary key,
    grey_id int default 0  not null comment '灰度id',
    grey_type varchar(100) default '' not null comment '灰度类型',
    grey_switch tinyint(1) default 1  not null comment '灰度开关 0关闭直接返回false 1开启走灰度逻辑 2 灰度结束直接返回true',
    white_list varchar(1024) default '' null comment '白名单，直接返回true',
    black_list       varchar(10240) default '' null comment '黑名单，加入后返回false，优先级高于白名单',
    account_interval varchar(64)    default '' null comment '灰度区间，eg: 0,12 左闭右开',
    create_time datetime default CURRENT_TIMESTAMP null
create index user_grey_uid_index
    on user_grey (uid);
);

```

### 代码逻辑设计



# 本人真的真的不善于写文档，一会直接贴代码了 日！